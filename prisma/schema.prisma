generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserSettings {
  id              String   @id @default(cuid())
  defaultLocation String   @default("Balbriggan, IE")
  latitude        Float    @default(53.6108)
  longitude       Float    @default(-6.1817)
  raceDate        DateTime @default(dbgenerated("'2026-05-17 10:00:00'::timestamp without time zone"))
  raceName        String   @default("Life Style Sports Fastlane Summer Edition 2026")
  targetTime      String   @default("2:00:00")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model WeatherCache {
  id            String   @id @default(cuid())
  location      String   // Location name, e.g., "Balbriggan, IE"
  latitude      Float
  longitude     Float
  datetime      DateTime // Forecast timestamp
  condition     String   // Weather condition, e.g., "Clear", "Light Rain", "Heavy Snow"
  description   String   // Detailed weather description
  temperature   Float    // Temperature in Celsius
  feelsLike     Float    // Feels-like temperature in Celsius
  precipitation Float    // Precipitation probability 0-100
  humidity      Int      // Humidity percentage 0-100
  windSpeed     Float    // Wind speed in km/h
  windDirection Int      // Wind direction in degrees 0-360
  cachedAt      DateTime @default(now())
  expiresAt     DateTime // Cache expiry time (TTL: 1 hour)

  @@unique([location, datetime])
  @@index([location, datetime])
  @@index([expiresAt])
}

// Enums for training plan and weather preferences
enum RunType {
  LONG_RUN
  EASY_RUN
  TEMPO_RUN
  INTERVAL_RUN
  RECOVERY_RUN
  RACE
}

enum Phase {
  BASE_BUILDING
  BASE_EXTENSION
  SPEED_DEVELOPMENT
  PEAK_TAPER
}

model TrainingPlan {
  id                  String   @id @default(cuid())
  phase               Phase
  weekNumber          Int      @unique
  weekStart           DateTime
  weekEnd             DateTime
  longRunTarget       Float    // km
  weeklyMileageTarget Float    // km
  notes               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([weekStart])
}

model WeatherPreference {
  id               String   @id @default(cuid())
  runType          RunType  @unique
  maxPrecipitation Float    // 0-100
  maxWindSpeed     Float?   // km/h, null = no limit
  minTemperature   Float?   // Celsius, null = no limit
  maxTemperature   Float?   // Celsius, null = no limit
  avoidConditions  String[] // e.g., ["Heavy Rain", "Thunderstorm"]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}
